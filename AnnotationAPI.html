
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Annotation API reference &#8212; Caliper 2.6.0-dev documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ConfigManager API reference" href="ConfigManagerAPI.html" />
    <link rel="prev" title="Building Caliper" href="build.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ConfigManagerAPI.html" title="ConfigManager API reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="build.html" title="Building Caliper"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Caliper 2.6.0-dev documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="annotation-api-reference">
<h1>Annotation API reference<a class="headerlink" href="#annotation-api-reference" title="Permalink to this headline">¶</a></h1>
<p>Caliper provides source-code annotation APIs to mark and name code
regions or features of interest. The high-level annotation API
provides easy access to pre-defined annotation types. The low-level
annotation API lets users create their own context attributes to
capture custom code features.</p>
<div class="section" id="high-level-annotations">
<h2>High-level Annotations<a class="headerlink" href="#high-level-annotations" title="Permalink to this headline">¶</a></h2>
<p>Caliper provides pre-defined annotation types for functions, loops,
and user-defined code regions, and a set of C and C++ macros to mark
and name those entities.</p>
<div class="section" id="function-annotations">
<h3>Function Annotations<a class="headerlink" href="#function-annotations" title="Permalink to this headline">¶</a></h3>
<p>Function annotations export the name of the annotated function, which
is taken from the <code class="docutils literal notranslate"><span class="pre">__FUNC__</span></code> compiler macro. The annotations should
be placed within a function of interest, ideally near the top. In C,
the function begin and <em>all</em> exit points must be marked. In C++, only
the begin has to be marked. Caliper exports the hierarchy of annotated
functions in the <cite>function</cite> attribute.</p>
<p>C++ example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;caliper/cali.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">CALI_CXX_MARK_FUNCTION</span><span class="p">;</span> <span class="c1">// Exports &quot;function=foo&quot;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
  <span class="c1">// In C++, the function annotation is closed automatically</span>
<span class="p">}</span>
</pre></div>
</div>
<p>C example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;caliper/cali.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">CALI_MARK_FUNCTION</span><span class="p">;</span>       <span class="cm">/* Exports &quot;function=foo&quot;          */</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CALI_MARK_FUNCTION_END</span><span class="p">;</span> <span class="cm">/* ALL exit points must be marked! */</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">CALI_MARK_FUNCTION_END</span><span class="p">;</span>   <span class="cm">/* ALL exit points must be marked! */</span>
  <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="loop-annotations">
<h3>Loop Annotations<a class="headerlink" href="#loop-annotations" title="Permalink to this headline">¶</a></h3>
<p>Loop annotations mark and name loops. The annotations should be placed
immediately outside a loop of interest. Both begin and end of the loop
have to be marked. Optionally, the loop iterations themselves can be
marked and the iteration number exported by placing loop iteration
annotations inside the loop body.  Caliper exports the loop name in
the <cite>loop</cite> attribute. Loop iterations are exported in per-loop
attributes named <cite>iteration#name</cite>, where <cite>name</cite> is the user-provided
loop name given to the loop annotation.</p>
<p>C++ example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;caliper/cali.h&gt;</span><span class="cp"></span>

<span class="n">CALI_CXX_MARK_LOOP_BEGIN</span><span class="p">(</span><span class="n">myloop_id</span><span class="p">,</span> <span class="s">&quot;myloop&quot;</span><span class="p">);</span> <span class="c1">// exports loop=myloop</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ITER</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CALI_CXX_MARK_LOOP_ITERATION</span><span class="p">(</span><span class="n">myloop_id</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>  <span class="c1">// exports iteration#myloop=&lt;i&gt;</span>

  <span class="c1">// In C++, the iteration annotation is closed automatically</span>
<span class="p">}</span>
<span class="n">CALI_CXX_MARK_LOOP_END</span><span class="p">(</span><span class="n">myloop_id</span><span class="p">);</span>
</pre></div>
</div>
<p>C example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;caliper/cali.h&gt;</span><span class="cp"></span>

<span class="n">CALI_MARK_LOOP_BEGIN</span><span class="p">(</span><span class="n">myloop_id</span><span class="p">,</span> <span class="s">&quot;myloop&quot;</span><span class="p">);</span> <span class="c1">// exports loop=myloop</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ITER</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CALI_MARK_ITERATION_BEGIN</span><span class="p">(</span><span class="n">myloop_id</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="c1">// exports iteration#myloop=&lt;i&gt;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">test</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CALI_MARK_ITERATION_END</span><span class="p">(</span><span class="n">myloop_id</span><span class="p">);</span>    <span class="c1">// must mark ALL iteration exit points</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">CALI_MARK_ITERATION_END</span><span class="p">(</span><span class="n">myloop_id</span><span class="p">);</span>      <span class="c1">// must mark ALL iteration exit points</span>
<span class="p">}</span>
<span class="n">CALI_MARK_LOOP_END</span><span class="p">(</span><span class="n">myloop_id</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="code-region-annotations">
<h3>Code-region Annotations<a class="headerlink" href="#code-region-annotations" title="Permalink to this headline">¶</a></h3>
<p>Code-region annotations mark and name user-defined source code
regions. Caliper exports the region names in the <cite>annotation</cite>
attribute. Annotated code regions must be properly nested (see
<a class="reference internal" href="#nesting">Nesting</a>).</p>
<p>Example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;caliper/cali.h&gt;</span><span class="cp"></span>

<span class="n">CALI_MARK_BEGIN</span><span class="p">(</span><span class="s">&quot;Important code&quot;</span><span class="p">);</span> <span class="c1">// exports annotation=&quot;Important code&quot;</span>
<span class="c1">// ... important code</span>
<span class="n">CALI_MARK_END</span><span class="p">(</span><span class="s">&quot;Important code&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="nesting">
<h3>Nesting<a class="headerlink" href="#nesting" title="Permalink to this headline">¶</a></h3>
<p>Annotated source-code regions of any of the pre-defined context
attributes (<cite>function</cite>, <cite>loop</cite>, and <cite>annotation</cite>) can be nested within
each other. Caliper preserves this nesting information. Users must
ensure that the nesting is correct. That is, annotated code regions
have to be enclosed completely within each other; they cannot
partially overlap. Example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;caliper/cali.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">foo</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">CALI_CXX_MARK_FUNCTION</span><span class="p">;</span>

  <span class="n">CALI_MARK_BEGIN</span><span class="p">(</span><span class="s">&quot;outer&quot;</span><span class="p">);</span>
  <span class="n">CALI_MARK_BEGIN</span><span class="p">(</span><span class="s">&quot;inner&quot;</span><span class="p">);</span> <span class="c1">// The hierarchy is now &quot;foo/outer/inner&quot;</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">  CALI_MARK_END(&quot;outer&quot;);   // Error! Must end &quot;inner&quot; before &quot;outer&quot;!</span>
<span class="c">  CALI_MARK_END(&quot;inner&quot;);</span>
<span class="cp">#endif</span>

  <span class="n">CALI_MARK_END</span><span class="p">(</span><span class="s">&quot;inner&quot;</span><span class="p">);</span>
  <span class="n">CALI_MARK_END</span><span class="p">(</span><span class="s">&quot;outer&quot;</span><span class="p">);</span>   <span class="c1">// Correct nesting</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To annotate arbitrary features or regions that can overlap with
others, use the low-level annotation API and create a user-defined
context attribute.</p>
</div>
</div>
<div class="section" id="low-level-annotation-api">
<h2>Low-level Annotation API<a class="headerlink" href="#low-level-annotation-api" title="Permalink to this headline">¶</a></h2>
<p>The “low-level” annotation API lets users create and export additional
context attributes with user-defined names to capture custom code
features or annotate arbitrary, non-nested code regions.</p>
<div class="section" id="attribute-keys">
<h3>Attribute keys<a class="headerlink" href="#attribute-keys" title="Permalink to this headline">¶</a></h3>
<p>Context attributes are the basic element in Caliper’s key:value data
model. The high-level annotation API uses pre-defined attribute keys,
but users can create their own. Attribute keys have a unique name, and
store the attribute’s data type as well as optional property flags.
Property flags control how the Caliper runtime system handles the
associated attributes.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>doxygenenum: Cannot find file: /home/david/Documents/src/Caliper-master/build-opt/doc/doxygen/xml/index.xml</p>
</div>
<p>Attribute keys can be created with <code class="xref c c-func docutils literal notranslate"><span class="pre">cali_create_attribute()</span></code>:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>doxygenfunction: Cannot find file: /home/david/Documents/src/Caliper-master/build-opt/doc/doxygen/xml/index.xml</p>
</div>
</div>
<div class="section" id="c-annotation-api">
<h3>C annotation API<a class="headerlink" href="#c-annotation-api" title="Permalink to this headline">¶</a></h3>
<p>The C annotation API provides the
<code class="docutils literal notranslate"><span class="pre">cali_begin_*[byname]</span></code>, <code class="docutils literal notranslate"><span class="pre">cali_end[_byname]</span></code>, and
<code class="docutils literal notranslate"><span class="pre">cali_set_*_[byname]</span></code> family of functions. Their behavior is as
follows:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">begin</span></code></dt><dd><p>Marks the begin of a region with the given attribute/value. The new
value will be nested under already open regions of the same
attribute.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set</span></code></dt><dd><p>Sets or overwrites the top-most value for the given attribute.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">end</span></code></dt><dd><p>Closes the top-most open region for the given attribute.</p>
</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">byname</span></code> variants refer to attribute keys by their name. If no
attribute key with the given name exists, it will be created with
default properties. The basic variants take an attribute ID, e.g.
from <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">cali_create_attribute()</span></code>.</p>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;caliper/cali.h&gt;</span><span class="cp"></span>

<span class="cm">/* Exports CustomAttribute=&quot;My great example&quot; */</span>
<span class="n">cali_begin_string_byname</span><span class="p">(</span><span class="s">&quot;CustomAttribute&quot;</span><span class="p">,</span> <span class="s">&quot;My great example&quot;</span><span class="p">)</span>

<span class="cm">/* Creates attribute key &quot;myvar&quot; with ASVALUE storage property */</span>
<span class="n">cali_id_t</span> <span class="n">myvar_attr</span> <span class="o">=</span>
  <span class="n">cali_create_attribute</span><span class="p">(</span><span class="s">&quot;myvar&quot;</span><span class="p">,</span> <span class="n">CALI_TYPE_INT</span><span class="p">,</span> <span class="n">CALI_ATTR_ASVALUE</span><span class="p">);</span>

<span class="cm">/* Exports myvar=42 */</span>
<span class="n">cali_set_int</span><span class="p">(</span><span class="n">myvar_attr</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>

<span class="cm">/* Closes CustomAttribute=&quot;My great example&quot; */</span>
<span class="n">cali_end_byname</span><span class="p">(</span><span class="s">&quot;CustomAttribute&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>C++ annotation API<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The C++ annotation API is implemented in the class
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">cali::Annotation</span></code>.</p>
</div>
</div>
<div class="section" id="data-tracking-api">
<h2>Data tracking API<a class="headerlink" href="#data-tracking-api" title="Permalink to this headline">¶</a></h2>
<p>Caliper also supports tracking allocated data. Doing so provides
advanced data-centric attributes, such as recording allocation events
and determining the containers for memory addresses provided by
services like libpfm. To take advantage of annotated memory
allocations, the <a class="reference internal" href="services.html#alloc-service"><span class="std std-ref">alloc</span></a> service must be enabled
at runtime.</p>
<p>Memory allocation annotations are similar to code region annotations,
we can define labels for allocations using macros, which will use the
variable name of the given pointer as label for the memory
allocations.  We can either label 1-dimensional ranges of bytes using
<cite>CALI_DATATRACKER_TRACK</cite> or multi-dimensional ranges of specified
element sizes using <cite>CALI_DATATRACKER_TRACK_DIMENSIONAL</cite>.  The
following example shows both:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">do_work</span><span class="p">(</span><span class="n">size_t</span> <span class="n">M</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">W</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">double</span> <span class="o">*</span><span class="n">arrayA</span> <span class="o">=</span> <span class="p">(</span><span class="n">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
    <span class="n">CALI_DATATRACKER_TRACK</span><span class="p">(</span><span class="n">arrayA</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>

    <span class="n">double</span> <span class="o">*</span><span class="n">matA</span> <span class="o">=</span>
         <span class="p">(</span><span class="n">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">)</span><span class="o">*</span><span class="n">M</span><span class="o">*</span><span class="n">W</span><span class="p">);</span>

    <span class="n">size_t</span> <span class="n">num_dimensions</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">size_t</span> <span class="n">A_dims</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">M</span><span class="p">,</span><span class="n">W</span><span class="p">};</span>
    <span class="n">CALI_DATATRACKER_TRACK_DIMENSIONAL</span><span class="p">(</span>
                <span class="n">matA</span><span class="p">,</span>
                <span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">),</span>
                <span class="n">A_dims</span><span class="p">,</span>
                <span class="n">num_dimensions</span><span class="p">);</span>
        <span class="o">...</span>

    <span class="n">CALI_DATATRACKER_FREE</span><span class="p">(</span><span class="n">arrayA</span><span class="p">);</span>
    <span class="n">CALI_DATATRACKER_FREE</span><span class="p">(</span><span class="n">matA</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>doxygengroup: Cannot find file: /home/david/Documents/src/Caliper-master/build-opt/doc/doxygen/xml/index.xml</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/caliper-logo-small.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Annotation API reference</a><ul>
<li><a class="reference internal" href="#high-level-annotations">High-level Annotations</a><ul>
<li><a class="reference internal" href="#function-annotations">Function Annotations</a></li>
<li><a class="reference internal" href="#loop-annotations">Loop Annotations</a></li>
<li><a class="reference internal" href="#code-region-annotations">Code-region Annotations</a></li>
<li><a class="reference internal" href="#nesting">Nesting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#low-level-annotation-api">Low-level Annotation API</a><ul>
<li><a class="reference internal" href="#attribute-keys">Attribute keys</a></li>
<li><a class="reference internal" href="#c-annotation-api">C annotation API</a></li>
<li><a class="reference internal" href="#id1">C++ annotation API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-tracking-api">Data tracking API</a></li>
<li><a class="reference internal" href="#api-reference">API Reference</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="build.html"
                        title="previous chapter">Building Caliper</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ConfigManagerAPI.html"
                        title="next chapter">ConfigManager API reference</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/AnnotationAPI.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ConfigManagerAPI.html" title="ConfigManager API reference"
             >next</a> |</li>
        <li class="right" >
          <a href="build.html" title="Building Caliper"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Caliper 2.6.0-dev documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015-2016, Lawrence Livermore National Laboratory.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.1.
    </div>
  </body>
</html>